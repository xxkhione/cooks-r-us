@page "/search"
@using CooksRUs.Models
@inject IHttpClientFactory ClientFactory

<PageTitle>Search</PageTitle>



<header>
    <div>
        <nav>
            <h1>🔍 Look For Recipes Here!</h1>
        </nav>
    </div>
    <div>
        <input type="text" id="search-bar" class="search-input" @bind="SearchText" @bind:event="oninput"/>
        <button class="search-button" id="search-btn" @onclick="SearchAsync">Search 😋</button>
        <div style="border-top: 1px solid #6d3703 ; margin: 10px 0;"></div>
    </div>

</header>
<main class="container">
    @if (Recipes is null)
    {
        <p>Type a keyword to search for recipes.</p>
    }
    else if (Recipes.Count == 0)
    {
        <p>No recipes found.</p>
    }
    else
    {
        @foreach (var recipe in Recipes)
        {
            <div class="item">
                <div style="border-top: 1px solid #6d3703 ; margin: 10px 0;"></div>
                <h2>@recipe.RecipeName</h2>
                <div style="border-top: 1px solid #6d3703 ; margin: 10px 0;"></div>
                <div class="recipe-main">
                    <img class="recipe-image" src="@recipe.Image" alt="@recipe.RecipeName"/>
                    <p class="recipe-directions">@recipe.Directions</p>
                </div>
                <ul class="recipe-ingredients">
                    @foreach (var ingredient in recipe.IngredientList)
                    {
                        <li>@ingredient.Measurement @ingredient.IngredientName</li>
                    }
                </ul>
            </div>
        }
    }
</main>

<div class="footer-flex">
    <footer>
        <p>&copy; 2025 Cooks R Us. All rights reserved.</p>
    </footer>
</div>


@code{
    private string SearchText { get; set; } = string.Empty;
    private List<Recipe>? Recipes { get; set; }

    private async Task SearchAsync()
    {
        if (string.IsNullOrWhiteSpace(SearchText))
        {
            Recipes = new List<Recipe>();
            return;
        }

        var client = ClientFactory.CreateClient("BackendApi");

        Recipes = await client.GetFromJsonAsync<List<Recipe>>($"api/recipes?searchQuery={Uri.EscapeDataString(SearchText)}");
    }
}
